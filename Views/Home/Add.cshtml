@model TrueStoryMVC.Models.ViewModels.PostModel

<div class="col-sm-9">
    <form asp-action="add" asp-controller="home" enctype="multipart/form-data">
        <div class="form-group">
            <input class="form-control" placeholder="Введите заголовок" />
        </div>
        <div class="form-group">
            <textarea placeholder="Введите текст" class="form-control" style="resize: none "></textarea>
        </div>
        <div class="form-group">
            <input type="file" onchange="readFile(this)" accept="image/jpeg,image/jpg,image/png" class="form-control-file" multiple />
        </div>

        <div class="form-group">
            <input placeholder="Введите тэги через пробел" class="form-control" />
        </div>
        <div class="form-group">
            <input type="submit" value="Отправить" class="btn btn-default" />
        </div>
    </form>


</div>


<script>
    function binArray() {
        let images = [];
        return function (img) {
            images.push(img);
            return images;
        }
    }

    let addImg = binArray();

    function ReadURL(input, i) {
        let file = input.files[i];
        let reader = new FileReader();

        reader.readAsDataURL(file);

        let div = document.createElement("div");
        let img = document.createElement("img");
        reader.onloadend = function () {
            img.src = reader.result;
        }

              
        div.className = "someImage row";
        let col2 = document.createElement("div");
        col2.className = "col-sm-2";
        let p = document.createElement("p");
        p.innerHTML = 'x';
        p.style.textAlign = "center";
        p.addEventListener("click", (e) => e.target.parentElement.parentElement.style.display = 'none');
        col2.append(p);
        div.append(col2);
        let col10 = document.createElement("div");
        col10.className = "col-sm-10";
        col10.append(img);
        div.append(col10);
        input.after(div);

        img.onload = function () {
            let k = img.height / img.width;
            img.width = 600;
            img.height = 600 * k;
        }
    }

    function ReadBinary(input, i) {
        let file = input.files[i];
        let reader = new FileReader();
        reader.readAsArrayBuffer(file);

        reader.onloadend = function () {
            addImg(reader.result);
        }
    }

    function readFile(input) {
        for (let i = 0; i < input.files.length; i++) {

            ReadURL(input, i);
            ReadBinary(input, i);
        }
    }
</script>

@*0) отпралять на сервер json, после его как-то обрабатывать
    1) При помощи js добавить возможность добавлять новые дивы
    2) При добавлении картинок они должны сразу же отобрадатся, чтобы выглядело так, как это будет при публикации
    3) Автоматически должен заполнятся скрытый input по значению которого можно будет все правильно выставить при публикации*@